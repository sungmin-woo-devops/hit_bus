{% extends "base.html" %}

{% block title %}ë²„ìŠ¤ ë…¸ì„  ì •ë³´ - MyWebsite{% endblock %}

{% block extra_css %}
<style>
  :root {
    --main-color: #2d8cf0;
    --main-hover: #1a75d1;
    --text-color: #333;
    --label-color: #555;
    --value-color: #222;
    --error-color: red;
    --box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
  }

  body {
    font-family: 'Segoe UI', sans-serif;
    background-color: #f9f9f9;
    color: var(--text-color);
  }

  h1 {
    text-align: center;
    color: var(--text-color);
    margin-top: 8rem;
    font-size: 2rem;
  }

  .search-box {
    text-align: center;
    margin: 2rem 0;
  }

  input[type="text"] {
    padding: 0.5rem 0.75rem;
    font-size: 1rem;
    width: 200px;
    border-radius: 4px;
    border: 1px solid #ccc;
    transition: border 0.3s ease;
  }

  input[type="text"]:focus {
    outline: none;
    border-color: var(--main-color);
  }

  button {
    padding: 0.5rem 1rem;
    font-size: 1rem;
    background-color: var(--main-color);
    color: #fff;
    border: none;
    border-radius: 4px;
    margin-left: 0.5rem;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  button:hover {
    background-color: var(--main-hover);
  }

  .card {
    background-color: white;
    border-radius: 8px;
    padding: 20px;
    max-width: 600px;
    margin: 20px auto;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

   .row {
    display: flex;
    justify-content: space-between;
    align-items: flex-start; /* â† top ì •ë ¬ë¡œ ë°”ê¿” í…ìŠ¤íŠ¸ ë°€ë¦¼ ë°©ì§€ */
    margin-bottom: 12px;
    gap: 1rem; /* â† ì¢Œìš° ì—¬ë°± ë¶€ì—¬ */
    flex-wrap: wrap; /* â† í•„ìš”í•œ ê²½ìš° ì¤„ë°”ê¿ˆ í—ˆìš© */
    }

    .label {
    font-weight: bold;
    color: var(--label-color);
    min-width: 140px;
    max-width: 200px;
    word-break: keep-all;
    flex-shrink: 0;
    }

    .value {
    color: var(--value-color);
    flex: 1;
    white-space: normal; /* â† ì¤„ë°”ê¿ˆ í—ˆìš© */
    word-break: break-word; /* â† ë„ˆë¬´ ê¸´ ê°’ì´ ë°•ìŠ¤ë¥¼ ë„˜ì§€ ì•Šë„ë¡ */
    }

  .hidden {
    display: none;
  }

  #error {
    color: var(--error-color);
    text-align: center;
  }
</style>
{% endblock %}

{% block content %}
<h1>ğŸš ë²„ìŠ¤ ë…¸ì„  ì •ë³´ ì¡°íšŒ</h1>

<div class="search-box">
  <input type="text" id="routeInput" placeholder="ì˜ˆ: 13-4" />
  <button onclick="searchBus()">ì¡°íšŒ</button>
</div>

<div id="busInfo" class="card hidden"></div>
<div id="error" class="card hidden" style="color: red; text-align: center;"></div>
{% endblock %}

{% block extra_js %}
<script>
  const labelMap = {
    routeName: "ë…¸ì„ ",
    routeTypeName: "ë…¸ì„ ìœ í˜•",
    upFirstTime: "ì²«ì°¨ ì‹œê°„",
    downLastTime: "ë§‰ì°¨ ì‹œê°„",
    peekAlloc: "í˜¼ì¡ì‹œ ë°°ì°¨ ê°„ê²©(ë¶„)",
    nPeekAlloc: "ë¹„í˜¼ì¡ ë°°ì°¨ ê°„ê²©(ë¶„)",
    startStationName: "ì¶œë°œ ì •ë¥˜ì†Œ",
    endStationName: "ì¢…ì°© ì •ë¥˜ì†Œ",
    companyName: "ìš´ì†¡ íšŒì‚¬",
    companyTel: "íšŒì‚¬ ì—°ë½ì²˜",
    regionName: "ìš´í–‰ ì§€ì—­"
  };

  const displayOrder = [
    "routeName",
    "routeTypeName",
    "upFirstTime",
    "downLastTime",
    "peekAlloc",
    "nPeekAlloc",
    "startStationName",
    "endStationName",
    "companyName",
    "companyTel",
    "regionName"
  ];

  function searchBus() {
    const keyword = document.getElementById("routeInput").value.trim();
    if (!keyword) return alert("ë²„ìŠ¤ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");

    fetch(`/api/bus?route=${encodeURIComponent(keyword)}`)
      .then(res => res.json())
      .then(data => {
        const info = data.info;
        const container = document.getElementById("busInfo");
        const error = document.getElementById("error");
        container.classList.add("hidden");
        error.classList.add("hidden");

        if (!info || Object.keys(info).length === 0) {
          error.textContent = "âŒ ë²„ìŠ¤ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
          error.classList.remove("hidden");
          return;
        }

        container.innerHTML = displayOrder
          .filter(key => info[key])
          .map(key => `
            <div class="row">
              <span class="label">${labelMap[key]}</span>
              <span class="value">${info[key]}</span>
            </div>`)
          .join("");

        container.classList.remove("hidden");
      })
      .catch(() => {
        const error = document.getElementById("error");
        error.textContent = "âš ï¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
        error.classList.remove("hidden");
      });
  }
</script>
{% endblock %}
